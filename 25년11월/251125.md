# 251125



### JWT , JWE , JWS

금융쪽 API로 토큰을 발행하는데 문서를 읽다가 JWE, JWS라는 내용이 눈에 띄었다. 

JWT면 JWT지 JWE, JWS가 무엇인지 모르고 초기엔 오타라고 생각했다.



- JWT는 인터페이스

- JWE, JWS가 JWT의 구현체

- 토큰의 형태는 다음과 같다.

  - JWS RFC - JSON Web Signature (JWS) Overview 발췌:
    - JOSE Header
    - JWS Payload
    - JWS Signature

  - JWE RFC - JSON Web Encryption (JWE) Overview 발췌:

    - JOSE Header

    - JWE Encrypted Key

    - JWE Initialization Vector

    - JWE AAD

    - JWE Ciphertext

    - JWE Authentication Tag

- JWT는 말 그대로 Json Web token

  - Token 자체는 평문이다.
  - JWT 자체는 단순히 평문 토큰
  - JWE, JWS 방식 중 하나를 거의 필수적으로 선택

- 웹 어플리케이션에서 보안이 극히 중요하지 않다면 JWS를 사용

- 우리가 흔히 사용하는 JWT는 대부분 JWS이다.

  - 그렇기 때문에 강의, 블로그 대부분에서 설명하는 JWT가 사실상 JWS인 셈이다.

- JWT의 토큰에 담고자 하는 데이터는 'claim'이라는 영역에담는다.

  - JWS에서는 해당 Claim을 'payload'라고 하고, 
  - JWE에서는 해당 Claim을 'plaintext'라고 한다.
  - claim의 종류는 다음과 같다.
    - 하단 모든 것들은 Optional함
    - iss claim
    - sub Claim
    - aud Claim
    - exp Claim
    - nbf(Not Before) Claim
      - JWT가 수락되지 않아야하는 시간을 명시
    - iat(Issued At) Claim
    - jti(JWT ID) Claim

- JWS 생성단계

  - 1. JWS Payload 생성

       ```
       {
       	"sub" : "12345678",
           "name" : "John",
           "iat" : 1516230922
       }
       ```

       

    2. Payload를 BASE64URL로 인코딩

       ```
       BASE64URL(payload)
       -> 인코딩된 문자열 생성
       ```

    3. Header(Json 객체) 생성

       ```
       {
       	"alg" : "RS256",
       	"typ": "JWT"
       }
       // alg : 어떤 방식으로 서명할지, typ(Optional) : JWT임을 나타냄
       ```

       - Header부분은 Signature부분에 포함될 수도 안 될 수도 있음
         - 이에 따라 Protected 일수도 혹은 Unprotected일수도 있다.

    4. Header를 BASE64URL로 인코딩

       ```
       BASE64URL(UTF8(header_json))
       ```

       - JWS Compact의 첫번째 필드가 됨
       - Header가 Protected되지 않으면 빈 값이 들어갈 수도 있음

    5.  Signature 생성

       ```
             ASCII(BASE64URL(UTF8(JWS Protected Header)) || '.' ||
              BASE64URL(JWS Payload)). 
       ```

       - Header에 명시가 된 alg로 Signature를 생성
       - 주의) 
         - **Signautre에서 사용하는 Alg는 '암호화'에 수행되는 것이 아님!**
         - 서명에 사용되는 것으로서 데이터의 무결성을 보장하는 것일뿐!

    6. BASE64URL로 Signature 인코딩

    7. 최종 JWS 문자열

       ```
       <base64url(header)>.<base64url(payload)>.<base64url(signature)>
       
       ```

- JWS 검증단계

  - ```
    ASCII(BASE64URL(UTF8(JWS Protected Header)) || '.' || BASE64URL(JWS Payload))"
    ```

    - signature 알고리즘을 돌려서 내용을 확인

https://seholee.com/blog/jwt-jwe-jws/



---



### RS256 / HS 256

* RS256

  - 서명: 서버 Private Key

  - 검증: 누구나 서버의 Public Key

* HS256사용 시

  - 서명: 서버의 secret key

  - 검증: 같은 secret key

- 
