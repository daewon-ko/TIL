# TIL240308

# 쇼핑몰 프로젝트 관련 

* 장바구니 <-> 상품
  * 하나의 장바구니에는 여러 상품이 존재한다.
  * 하나의 상품이 여러 장바구니에 들어갈 수 있다.
  * 따라서 장바구니와 상품은 다대다관계이다.
* cart_product라는 Entity를 따로 추출할 수 있다.

### 요구사항 정의(기능 중심으로)

| 기능(Entity 중심)                   |                             설명                             |                             비고                             |
| :---------------------------------- | :----------------------------------------------------------: | :----------------------------------------------------------: |
| 회원(user)는 회원가입을 할 수 있다. |   Oauth2를 통한 소셜로그인을 통한 회원가입 역시 가능하다.    | 자체회원가입은 추후 기능 추가 예정<br />일단은 소셜로그인만으로 진행 |
| 장바구니(cart)                      |     구매할 상품의 종류와 수량을 장바구니에 담을 수 있다.     | 비회원일 시 장바구니에 담고있다가, <br />로그인 시 기존에 존재하고있던 장바구니에 추가한다.비회원 - LocalStroage, 회원 - DB에 저장하고, <br />로그인 시 장바구니 DB에 합쳐서 저장 |
| 구매상품내역 조회                   |              회원의 구매내역을 조회할 수 있다.               | 회원과 연결된 주문테이블에서 주문상태가 '결제', '완료'인 것들을 <br />컬렉션 등으로 모아서 조회할 수 있다. <br />또한 원하는 조건별로 검색할 수 있다. <br />상품이름, 날짜, 주문번호? |
| 리뷰(review)                        | 상품을 구매한 회원은 리뷰글을 <br />작성할 수 있다. <br />또한 해당 리뷰글은 모든 회원이 조회가능하다. | 해당 리뷰글은 특정 상품의 페이지에서 확인할 수 있다. <br />리뷰글이 남겨지면 판매자에게 실시간 알림이 간다. |
| 문의(Ana)                           | 모든 회원은 해당 상품에 대해서 <br />상품에 대한 문의를 작성할 수 있다. | 해당 문의글은 특정 상품의 페이지에서 확인할 수 있다.<br />문의글이 남겨지면 판매자에게 실시간 알림이 간다. |
| 주문(Order)                         |  장바구니에 들어있는 상품에 대해서 결제 및 주문이 가능하다.  | 회원과 비회원 모두 주문가능하다? <br />결제모듈등은 iamport api 등을 이용한다. |
| 댓글(reply)                         | 문의 및 주문 글에 대해서 사용자는 댓글을 작성, 수정, 삭제할 수 있다. <br />(자기 자신의 댓글에 대해서) |     리뷰와 댓글은 작성자(사용자) 또는 판매자만 가능하다.     |

* Domain별 기능 목록 구상

* 1. 회원

     * 회원은 회원가입을 할 수 있다.

       * [GET] /sign-up(회원가입 페이지 링크로 이동)
       * [POST]/sign-up
         * UserSingUpReqDto
         * UserSingUpResDto

     * 회원은 로그인을 할 수 있다.

       * [GET]/ sign-in(로그인 페이지 링크로 이동)

       * [POST]/sign-in(로그인 로직)

         * 로그인 성공 시 -> Session 생성 및 

           "redirect:/"+"/homeLogin"으로 이동

         * 로그인 실패 시 -> 비동기로 팝업창 등을 띄어준다. 

           * <b>(자바스크립트 ajax 등을 이용? )</b>
           * bindingResult로 catch 후 
             "redirect:/"+"+login"으로 이동

     * 회원은 로그아웃을 할 수 있다. 

       * {POST}/logout
         * session.invalidate 메서드를 Controller에서 이용
       * Session 삭제

     * 회원은 장바구니에 상품을 담을 수 있다. 

       * 

     * 상기의 모든 기능은 모든 페이지에서 진행할 수 있다. 

       * 일반적인 웹페이지처럼 우측 상단에 로그인, 로그아웃, 회원가입 버튼에 대해서 각 URL을 링크한다. 

         <img width="1437" alt="image" src="https://github.com/daewon-ko/TIL/assets/105340285/a026df24-6b28-4fc1-b665-0099e071a009">

  2. 상품

     * 상품을 생성할 수 있다. 
       * {POST}/product
       * 상품은 일반 사용자를 제외한 판매자만 생성할 수 있다. 
       * ***<b>어떻게 판매자만 생성할 수 있게끔 구현할 수 있나?</b>***
       
       * 페이징 처리가 필요하다. 
       
     * 상품을 삭제할 수 있다.
  
       * {DELETE}/product
  
     * 상품을 수정할 수 있다.

       * {PATCH}/product
         * URL명 재고려 필요
  
     * 모든 상품을 조회할 수 있다.
  
       * GET/products?category=&
         * 카테고리별 조회
         * 가격별 조회
         * 할인율별 조회
         * product의 속성들을 토대로 조회가 가능하다.
  
  3. 주문
  
     * 회원은 주문을 할 수 있다. 
       * {POST}/order
         * 주문할 시에, 상품 테이블의 가격, 할인율과 같아야한다. 
         * 다를 시에, 상품의 가격, 할인율로 수정해야한다. 
  
     * 회원은 주문을 수정할 수 있다.
  
       * {POST}/update-order
  
       * 단, 주문상태가 '준비'여야만 한다.
  
     * 회원은 주문을 취소할 수 있다.
  
       * {DELETE}/order
  
       * 단, 주문상태가 '준비'여야만 한다.
  
     * 회원은 자신의 주문내역을 조회할 수 있다.
  
       * {GET}/orders?productName=&date&
  
       * 상품이름, 날짜,.. 등으로 조회가능하다.
  
  4. 장바구니
  
     * 회원은 장바구니에 상품을 넣을 수 있다.
       * {POST}/carts
       * 주문의 가격, 할인율과 상품의 가격, 할인율을 체크하고 같지 않으면 상품의 가격, 할인율로 반영한다.
     * 회원은 장바구니를 삭제할 수 있다.
       * {DELETE}/carts/{cartId}
     * 회원은 장바구니를 수정할 수 있다.
       * {PUT}/carts
     * 회원은 장바구니를 조회할 수 있다.
       * {GET}/carts/{cartId}
       * <b>*자기 자신의 장바구니만 조회 가능하다.*</b>



### 고려사항

* PUT메서드를 POST로 대체가능하지 않나?
* 실무에서는 어느 것이 더 많이 사용되지?

### 쿠키, 세션



* 쿠키의 생성위치는 서버인데, 쿠키를 저장하고 있는 곳은 브라우저이다.
* HTTP 요청시마다, 브라우저가 서버에 Cookie의 값을 보낸다고 해도, 브라우저에서는 쿠키의 값을 저장하고 있지않는한, 
  쿠키를 통해서 사용자를 식별할 수 없지않나? 
* 세션을 이용하지 않은 순수한 쿠키의 사용만으로 사용자를 어떻게 식별할 수 있는가? 



